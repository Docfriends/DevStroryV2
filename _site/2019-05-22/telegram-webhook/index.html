<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>텔레그램 웹훅 받기</title>

  <!-- CSS -->
  <link rel="stylesheet" href="/DevStrory/assets/css/main.css" type="text/css">

  <!-- Font -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-kr.css' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Docfriends 기술 블로그" href="/DevStrory/feed.xml" />
    <link href="https://docfriends.github.io/DevStrory/assets/images/favicon.ico" rel="shortcut icon"
          type="image/x-icon"/>
    <link href="https://docfriends.github.io/DevStrory/assets/images/logo.png" rel="icon" type="image/png"/>


  <meta name="apple-mobile-web-app-title" content="DocfriendsTec" />
  <meta name="description" content="닥프렌즈의 기술 블로그"/>
  <meta property="og:title" content="닥프렌즈">
    <meta content="https://docfriends.github.io/DevStrory/" property="og:url">
    <meta content="https://docfriends.github.io/DevStrory/assets/images/logo.png" property="og:image">
  <meta property="og:description" content="닥프렌즈의 기술 블로그"/>
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="">
    <meta content="https://docfriends.github.io/DevStrory/" name="twitter:url">
    <meta content="https://docfriends.github.io/DevStrory/assets/images/logo.png" name="twitter:image">
  <meta name="twitter:description" content="닥프렌즈의 기술 블로그"/>


  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>텔레그램 웹훅 받기 | Docfriends 기술 블로그</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="텔레그램 웹훅 받기" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="텔레그램에서 웹훅으로 데이터 받고 텔레그램으로 데이터 보내기" />
<meta property="og:description" content="텔레그램에서 웹훅으로 데이터 받고 텔레그램으로 데이터 보내기" />
<link rel="canonical" href="http://localhost:4000/DevStrory/2019-05-22/telegram-webhook/" />
<meta property="og:url" content="http://localhost:4000/DevStrory/2019-05-22/telegram-webhook/" />
<meta property="og:site_name" content="Docfriends 기술 블로그" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-05-22T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="텔레그램 웹훅 받기" />
<script type="application/ld+json">
{"url":"http://localhost:4000/DevStrory/2019-05-22/telegram-webhook/","headline":"텔레그램 웹훅 받기","datePublished":"2019-05-22T00:00:00+09:00","dateModified":"2019-05-22T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/DevStrory/2019-05-22/telegram-webhook/"},"description":"텔레그램에서 웹훅으로 데이터 받고 텔레그램으로 데이터 보내기","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->



  <!-- Google Analytics -->

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-131153272-1', 'auto');
ga('send', 'pageview');

</script>



</head>

<body>
  <div class="content-container">
    <header class="header">
  <div class="header-title">
    <a href="http://localhost:4000/DevStrory">Docfriends 기술 블로그</a>
  </div>
  <nav class="header-nav">
    
    
    <a href="/DevStrory/">Post</a>
    
    
    
    <a href="/DevStrory/member">Member</a>
    
    
    
    <a href="/DevStrory/archive">Archive</a>
    
    
    
    <a href="/DevStrory/tags">Tags</a>
    
    
    
    <a href="https://github.com/Docfriends">Github</a>
    
    
  </nav>
</header>

<div class="post, container-content">
  <div class="post-title">텔레그램 웹훅 받기</div>




<div class="post-writergroup">
  <a class="post-writerselect" href="https://github.com/pikachu987" title="https://github.com/pikachu987">
    <span class="post-writer" >Writer: 김관호 </span>
    <img class="post-profile" src="http://localhost:4000/DevStrory/assets/images/member/pikachu987.png" onerror="this.src='http://localhost:4000/DevStrory/assets/images/member/defaultProfile.png'">
  </a>
</div>




  <span class="post-date">
    <time>22 May 2019</time>
  </span>
  <div class="post-tag">
    <ul>
      
      <li>
        <a href="http://localhost:4000/DevStrory/tags#Telegram">
          <span>Telegram</span>
        </a>
      </li>
      
      
      <li>
        <a href="http://localhost:4000/DevStrory/tags#Webhook">
          <span>Webhook</span>
        </a>
      </li>
      
      
    </ul>
  </div>

  <p><a href="https://core.telegram.org/bots/api" target="blank">텔레그램 봇 사이트</a></p>

<h3 id="1봇-만들기">1.봇 만들기</h3>

<h5 id="1-botfather">1) BotFather</h5>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/botFather.png" alt="BotFather" /></p>

<p>텔레그램에서 BotFather를 찾습니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/botFatherStart.png" alt="BotFatherStart" /></p>

<p>BotFather를 선택하고 Start 버튼을 누릅니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/botFatherStartInput.png" alt="BotFatherStartInput" /></p>

<p>여러가지 메뉴가 나옵니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/newBot.png" alt="NewBot" /></p>

<p><code class="language-plaintext highlighter-rouge">/newbot</code>을 입력합니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/name.png" alt="Name" /></p>

<p>봇의 이름을 적습니다.<br />
원하는 이름을 적으면 됩니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/botId.png" alt="BotId" /></p>

<p>봇의 유저네임을 입력합니다.<br />
봇의 유저네임은 중복이 안됩니다.<br />
봇의 토큰이 나왔습니다 🎉🎉🎉</p>

<h5 id="2-채팅방-id">2) 채팅방 ID</h5>

<p>봇과 대화한 채팅방 ID는 <a href="https://api.telegram.org/bot/getUpdates" target="blank">https://api.telegram.org/bot${telegramBotToken}/getUpdates</a> 에서 알수 있습니다.<br />
${telegramBotToken}은 아까 얻은 token을 입력해 줍니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/emptyValue.png" alt="EmptyValue" /></p>

<p>아무값이 없네요.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/myBot.png" alt="MyBot" /></p>

<p>텔레그램에서 방금 만든 봇을 검색합니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/myBotChat.png" alt="MyBotChat" /></p>

<p>Start 버튼을 눌러줍니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/start.png" alt="Start" /></p>

<p>다시 <a href="https://api.telegram.org/bot/getUpdates" target="blank">https://api.telegram.org/bot${telegramBotToken}/getUpdates</a> 여기에서 봇 토큰을 입력하고 들어가 봅니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/chatId.png" alt="ChatId" /></p>

<p>데이터가 나왔습니다 🎉🎉🎉<br />
ID는 result - message - chat - id 에서 볼 수 있습니다.</p>

<h5 id="3-id-찾기">3) ID 찾기</h5>

<p><span>봇 토큰 입력</span><br />
(결과값 간단히 보기 <input id="check_find_bot_id" checked="true" type="checkbox" />)<br />
<input id="input_bot_token" type="text" value="" placeholder="봇 토큰을 입력해 주세요." style="height: 40px; width: 80%; border: 2px solid black; border-radius: 5px; font-size: 15px;" />
<button id="search_bot_id" style="height:44px; width: 15%; border-top: 2px solid black; border-radius: 5px; font-size: 16px; background-color: black; color: white;">찾기</button></p>
<pre id="print_bot_id" style="padding: 0px; margin: 0px;"></pre>

<h3 id="3텔레그램에-메시지-보내기">3.텔레그램에 메시지 보내기</h3>

<h5 id="1-메시지-보내기">1) 메시지 보내기</h5>

<p><a href="https://api.telegram.org/bot/sendMessage?chat_id=&amp;text=" target="blank">https://api.telegram.org/bot${telegramBotToken}/sendMessage?chat_id=${telegramChatId}&amp;text=${text}</a></p>

<p>${telegramBotToken}은 봇 token을 입력해 줍니다.<br />
${telegramChatId}은 채팅 ID를 입력해 줍니다.<br />
${text}은 보낼 메시지를 입력해 줍니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/sendMessageURL.png" alt="SendMessageURL" /></p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/sendMessage.png" alt="SendMessage" /></p>

<p>메시지 보내기 성공 🎉🎉🎉</p>

<h5 id="2-메시지-보내기-테스트">2) 메시지 보내기 테스트</h5>

<p><span>봇 토큰 입력</span><br />
<input id="input_send_message_bot_token" type="text" value="" placeholder="봇 토큰을 입력해 주세요." style="height: 40px; width: 100%; border: 2px solid black; border-radius: 5px; font-size: 15px;" />
<span>보내질 채팅방 ID 입력</span><br />
<input id="input_send_message_chat_id" type="text" value="" placeholder="보내질 채팅방 ID를 입력해 주세요." style="height: 40px; width: 100%; border: 2px solid black; border-radius: 5px; font-size: 15px;" />
<span>보낼 메시지 입력</span><br />
<input id="input_send_message_text" type="text" value="" placeholder="보낼 메시지를 입력해 주세요." style="height: 40px; width: 100%; border: 2px solid black; border-radius: 5px; font-size: 15px;" /></p>

<p><button id="send_message" style="height:44px; width: 15%; border-top: 2px solid black; border-radius: 5px; font-size: 16px; background-color: black; color: white;">메시지 보내기</button></p>
<pre id="print_message" style="padding: 0px; margin: 0px;"></pre>

<h3 id="3웹훅-등록하기">3.웹훅 등록하기</h3>

<h5 id="1-웹훅을-받을-url만들기">1) 웹훅을 받을 URL만들기</h5>

<p><a href="http://localhost:4000/DevStrory/2019-05-20/make-lambda#temp1" target="blank">AWS Lambda 만들기</a> 로 가서 Lambda 함수와 APIGateway를 만듭니다.</p>

<h5 id="2-웹훅-등록">2) 웹훅 등록</h5>

<p><a href="https://api.telegram.org/bot/setWebhook?url=" target="blank">https://api.telegram.org/bot${telegramBotToken}/setWebhook?url=${callbackURL}</a></p>

<p>${telegramBotToken}은 봇 token을 입력해 줍니다.<br />
${callbackURL}은 Lambda함수와 연결되어 있는 APIGateway URL을 입력해 줍니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/webhookSuccess.png" alt="WebhookSuccess" /></p>

<p>웹훅 등록 성공 🎉🎉🎉</p>

<h5 id="3-웹훅-삭제">3) 웹훅 삭제</h5>

<p><a href="https://api.telegram.org/bot/setWebhook?url=" target="blank">https://api.telegram.org/bot${telegramBotToken}/setWebhook?url=</a></p>

<p>${telegramBotToken}은 봇 token을 입력해 줍니다.<br />
url을 비우면 웹훅 삭제가 됩니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/webhookDelete.png" alt="WebhookDelete" /></p>

<p>웹훅 삭제 성공 🎉🎉🎉</p>

<h5 id="4-웹훅-등록삭제">4) 웹훅 등록/삭제</h5>

<p><span>봇 토큰 입력</span><br />
<input id="input_webhook_bot_token" type="text" value="" placeholder="봇 토큰을 입력해 주세요." style="height: 40px; width: 100%; border: 2px solid black; border-radius: 5px; font-size: 15px;" />
<span>callbackURL 입력</span><br />
<input id="input_webhook_callbackURL" type="text" value="" placeholder="callbackURL을 입력해 주세요." style="height: 40px; width: 100%; border: 2px solid black; border-radius: 5px; font-size: 15px;" /></p>

<p><button id="webhook_set" style="height:44px; width: 15%; border-top: 2px solid black; border-radius: 5px; font-size: 16px; background-color: black; color: white;">웹훅 등록</button>
<button id="webhook_delete" style="height:44px; width: 15%; border-top: 2px solid black; border-radius: 5px; font-size: 16px; background-color: black; color: white;">웹훅 삭제</button>
<button id="webhook_info" style="height:44px; width: 15%; border-top: 2px solid black; border-radius: 5px; font-size: 16px; background-color: black; color: white;">웹훅 정보</button></p>
<pre id="print_webhook" style="padding: 0px; margin: 0px;"></pre>

<h3 id="4웹훅">4.웹훅</h3>

<h5 id="1-로그">1) 로그</h5>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/lambdaConsole.png" alt="LambdaConsole" /></p>

<p>callbackURL 에 등록된 Lambda함수에 event를 Log로 찍어보기 위해 <code class="language-plaintext highlighter-rouge">Console.log(event);</code> 를 적습니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/chat.png" alt="Chat" /></p>

<p>봇에게 채팅을 해봅니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/log.png" alt="Log" /></p>

<p>성공적으로 웹훅을 받고 로그에 출력했습니다 🎉🎉🎉</p>

<h5 id="2-웹훅을-받고-텔레그램에-메시지-보내기">2) 웹훅을 받고 텔레그램에 메시지 보내기</h5>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 텔레그램 봇 TOKEN</span>
<span class="kd">const</span> <span class="nx">TOKEN</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
<span class="c1">// 채팅방 ID</span>
<span class="kd">const</span> <span class="nx">SEND_ROOM_ID</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">https</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="nx">sendRequest</span><span class="p">(</span><span class="s2">`메시지를 보낸 사람: &lt;b&gt;</span><span class="p">${</span><span class="nx">item</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="k">from</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span><span class="s2">&lt;/b&gt;`</span><span class="p">);</span>
    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">statusCode</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">Access-Control-Allow-Origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">},</span>
        <span class="na">body</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Success</span><span class="dl">"</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">sendRequest</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">hostname</span><span class="p">:</span> <span class="dl">'</span><span class="s1">api.telegram.org</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">port</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">},</span>
      <span class="na">path</span><span class="p">:</span> <span class="s2">`/bot</span><span class="p">${</span><span class="nx">TOKEN</span><span class="p">}</span><span class="s2">/sendMessage`</span>
  <span class="p">},</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">body</span> <span class="o">=</span> <span class="nx">body</span> <span class="o">+</span> <span class="nx">chunk</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">problem with request: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="dl">"</span><span class="s2">%j</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">chat_id</span><span class="dl">"</span><span class="p">:</span> <span class="nx">SEND_ROOM_ID</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="nx">message</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">parse_mode</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">HTML</span><span class="dl">"</span>
  <span class="p">}));</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Model</span>

<span class="kd">function</span> <span class="nx">Item</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">update_id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">update_id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Message</span><span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">]</span> <span class="o">||</span> <span class="p">{});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Message</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">message_id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">message_id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="k">from</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">From</span><span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">from</span><span class="dl">"</span><span class="p">]</span> <span class="o">||</span> <span class="p">{});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">chat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Chat</span><span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">chat</span><span class="dl">"</span><span class="p">]</span> <span class="o">||</span> <span class="p">{});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">caption</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">caption</span><span class="dl">"</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">photo</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">photo</span><span class="dl">"</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">photos</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">photo</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">photo</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">photos</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Photo</span><span class="p">(</span><span class="nx">item</span> <span class="o">||</span> <span class="p">{}));</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">photo</span> <span class="o">=</span> <span class="nx">photos</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">Chat</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">first_name</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">first_name</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">last_name</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">last_name</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">From</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">is_bot</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">is_bot</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">first_name</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">first_name</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">last_name</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">last_name</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">language_code</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">language_code</span><span class="dl">"</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Photo</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">file_id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">file_id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">file_size</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">file_size</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">width</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">height</span><span class="dl">"</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Lambda 소스를 수정해봅니다.</p>

<p>Chat은 Chat에 대해서 나옵니다.<br />
From은 채팅을 보낸 사람에 대해 나옵니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/testComplete.png" alt="TestComplete" /></p>

<p>성공 🎉🎉🎉</p>

<h5 id="3-텔레그램-그룹방에-봇-추가">3) 텔레그램 그룹방에 봇 추가</h5>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/groupInfo.png" alt="GroupInfo" /></p>

<p>그룹방 Info에서 <strong>Add Members</strong> 를 선택합니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/groupBotSearch.png" alt="GroupBotSearch" /></p>

<p>추가할 봇을 찾습니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/groupBotAdd.png" alt="GroupBotAdd" /></p>

<p>봇을 추가합니다.</p>

<p><strong>또는</strong></p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/botInfo.png" alt="BotInfo" /></p>

<p>봇 Info에서 Add To Group를 선택합니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/botGroup.png" alt="BotGroup" /></p>

<p>그룹을 찾고 추가를 합니다.</p>

<p><br /><br /><br /></p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/groupEdit.png" alt="GroupEdit" /></p>

<p>그룹방 Info에서 Administrators를 누릅니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/groupAddAdmin.png" alt="GroupAddAdmin" /></p>

<p>Add Admin(관리자 추가)를 합니다.</p>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/groupAddBotAdmin.png" alt="GroupAddBotAdmin" /></p>

<p>테스트봇에 관리자 권한을 줍니다.</p>

<p>메시지를 받으면 그룹방에 바로 보내도록 Lambda 소스를 수정합니다.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 텔레그램 봇 TOKEN</span>
<span class="kd">const</span> <span class="nx">TOKEN</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">https</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">https</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Item</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="nx">sendRequest</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s2">`메시지를 보낸 사람: &lt;b&gt;</span><span class="p">${</span><span class="nx">item</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="k">from</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span><span class="s2">&lt;/b&gt;`</span><span class="p">);</span>
    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">statusCode</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">Access-Control-Allow-Origin</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">*</span><span class="dl">"</span><span class="p">},</span>
        <span class="na">body</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Success</span><span class="dl">"</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">sendRequest</span><span class="p">(</span><span class="nx">chatId</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nx">request</span><span class="p">({</span>
      <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">hostname</span><span class="p">:</span> <span class="dl">'</span><span class="s1">api.telegram.org</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">port</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">},</span>
      <span class="na">path</span><span class="p">:</span> <span class="s2">`/bot</span><span class="p">${</span><span class="nx">TOKEN</span><span class="p">}</span><span class="s2">/sendMessage`</span>
  <span class="p">},</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">body</span> <span class="o">=</span> <span class="nx">body</span> <span class="o">+</span> <span class="nx">chunk</span><span class="p">;</span>
      <span class="p">});</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">,</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
      <span class="p">});</span>
  <span class="p">});</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">problem with request: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="dl">"</span><span class="s2">%j</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">chat_id</span><span class="dl">"</span><span class="p">:</span> <span class="nx">chatId</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">:</span> <span class="nx">message</span><span class="p">,</span>
      <span class="dl">"</span><span class="s2">parse_mode</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">HTML</span><span class="dl">"</span>
  <span class="p">}));</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Model</span>

<span class="kd">function</span> <span class="nx">Item</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">update_id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">update_id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Message</span><span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">]</span> <span class="o">||</span> <span class="p">{});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Message</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">message_id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">message_id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="k">from</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">From</span><span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">from</span><span class="dl">"</span><span class="p">]</span> <span class="o">||</span> <span class="p">{});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">chat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Chat</span><span class="p">(</span><span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">chat</span><span class="dl">"</span><span class="p">]</span> <span class="o">||</span> <span class="p">{});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">date</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">date</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">caption</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">caption</span><span class="dl">"</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">photo</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">photo</span><span class="dl">"</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">photos</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">photo</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">photo</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">photos</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Photo</span><span class="p">(</span><span class="nx">item</span> <span class="o">||</span> <span class="p">{}));</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">photo</span> <span class="o">=</span> <span class="nx">photos</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">Chat</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">first_name</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">first_name</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">last_name</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">last_name</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">From</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">is_bot</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">is_bot</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">first_name</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">first_name</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">last_name</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">last_name</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">language_code</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">language_code</span><span class="dl">"</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Photo</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">file_id</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">file_id</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">file_size</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">file_size</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">width</span><span class="dl">"</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">element</span><span class="p">[</span><span class="dl">"</span><span class="s2">height</span><span class="dl">"</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/DevStrory/images/2019/telegram-webhook/groupMessageSuccess.png" alt="GroupMessageSuccess" /></p>

<p>성공 🎉🎉🎉</p>

<blockquote>
  <p>만약 봇이 작동을 안하면 /start 를 적어주시면 됩니다.</p>
</blockquote>

<script src="https://code.jquery.com/jquery-1.12.4.js"></script>

<script type="text/javascript">
$(document).ready(function() {

  $("#search_bot_id").click(function() {
    const telegramBotToken = $("#input_bot_token").val();

    if (telegramBotToken == "" || telegramBotToken == undefined) {
      $("#print_bot_id").empty();
      $("#print_bot_id").append("Bot 토큰을 입력하세요.");
      return
    }
    const urlPath = "https://api.telegram.org/bot"+telegramBotToken+"/getUpdates";

    $.ajax({
          type: "GET",
          url: urlPath,
          success: function(args) {
            $("#print_bot_id").empty();
            if ($("#check_find_bot_id").is(':checked')) {
              var results =  args["result"] || [];
              var chats = [];
              results.forEach(function (item, index, array) {
                var chat = (item["message"] || {})["chat"];

                var found = false;
                for(var i = 0; i < chats.length; i++) {
                    if (chats[i]["id"] == chat["id"]) {
                        found = true;
                        break;
                    }
                }
                if (!found) {
                  var data = {};
                  if (chat["title"] == undefined) {
                    data = {
                      "id": chat["id"],
                      "isGroup": false,
                      "username": chat["username"],
                    };
                  } else {
                    data = {
                      "id": chat["id"],
                      "isGroup": true,
                      "title": chat["title"],
                    };
                  }
                  chats.push(data);
                }
              });
              var json = JSON.stringify(chats, null, 4);
              $("#print_bot_id").append(document.createTextNode(json));
            } else {
              var json = JSON.stringify(args, null, 4);
              $("#print_bot_id").append(document.createTextNode(json));
            }
          },
          error: function(e) {
            var json = JSON.stringify(e, null, 4);
            $("#print_bot_id").empty();
            $("#print_bot_id").append(document.createTextNode(json));
          }
      });
  });

  $("#send_message").click(function() {
    const telegramBotToken = $("#input_send_message_bot_token").val();
    if (telegramBotToken == "" || telegramBotToken == undefined) {
      $("#print_message").empty();
      $("#print_message").append("Bot 토큰을 입력하세요.");
      return
    }
    const chatID = $("#input_send_message_chat_id").val();
    if (chatID == "" || chatID == undefined) {
      $("#print_message").empty();
      $("#print_message").append("보내질 채팅방 ID를 입력하세요.");
      return
    }
    const text = $("#input_send_message_text").val();
    if (text == "" || text == undefined) {
      $("#print_message").empty();
      $("#print_message").append("보낼 메시지를 입력하세요.");
      return
    }
    const urlPath = "https://api.telegram.org/bot"+telegramBotToken+"/sendMessage?chat_id="+chatID+"&text="+text;
    $.ajax({
        type: "GET",
        url: urlPath,
        success: function(args) {
          var json = JSON.stringify(args, null, 4);
          $("#print_message").empty();
          $("#print_message").append(document.createTextNode(json));
        },
        error: function(e) {
          var json = JSON.stringify(e, null, 4);
          $("#print_message").empty();
          $("#print_message").append(document.createTextNode(json));
        }
      });
  });

  $("#webhook_set").click(function() {
    const telegramBotToken = $("#input_webhook_bot_token").val();
    if (telegramBotToken == "" || telegramBotToken == undefined) {
      $("#print_webhook").empty();
      $("#print_webhook").append("Bot 토큰을 입력하세요.");
      return
    }
    const callbackURL = $("#input_webhook_callbackURL").val();
    if (callbackURL == "" || callbackURL == undefined) {
      $("#print_webhook").empty();
      $("#print_webhook").append("callbackURL을 입력하세요.");
      return
    }
    const webhookUrlPath = "https://api.telegram.org/bot"+telegramBotToken+"/setWebhook?url="+callbackURL;
    $.ajax({
        type: "GET",
        url: webhookUrlPath,
        success: function(args) {
          var json = JSON.stringify(args, null, 4);
          $("#print_webhook").empty();
          $("#print_webhook").append(document.createTextNode(json));
        },
        error: function(e) {
          var json = JSON.stringify(e, null, 4);
          $("#print_webhook").empty();
          $("#print_webhook").append(document.createTextNode(json));
        }
    });
  });

  $("#webhook_delete").click(function() {
    const telegramBotToken = $("#input_webhook_bot_token").val();
    if (telegramBotToken == "" || telegramBotToken == undefined) {
      $("#print_webhook").empty();
      $("#print_webhook").append("Bot 토큰을 입력하세요.");
      return
    }
    const webhookUrlPath = "https://api.telegram.org/bot"+telegramBotToken+"/setWebhook?url=";
    $.ajax({
        type: "GET",
        url: webhookUrlPath,
        success: function(args) {
          var json = JSON.stringify(args, null, 4);
          $("#print_webhook").empty();
          $("#print_webhook").append(document.createTextNode(json));
        },
        error: function(e) {
          var json = JSON.stringify(e, null, 4);
          $("#print_webhook").empty();
          $("#print_webhook").append(document.createTextNode(json));
        }
    });
  });

  $("#webhook_info").click(function() {
    const telegramBotToken = $("#input_webhook_bot_token").val();
    if (telegramBotToken == "" || telegramBotToken == undefined) {
      $("#print_webhook").empty();
      $("#print_webhook").append("Bot 토큰을 입력하세요.");
      return
    }
    const webhookUrlPath = "https://api.telegram.org/bot"+telegramBotToken+"/getWebhookInfo";
    $.ajax({
          type: "GET",
          url: webhookUrlPath,
          success: function(args) {
            var json = JSON.stringify(args, null, 4);
            $("#print_webhook").empty();
            $("#print_webhook").append(document.createTextNode(json));
          },
          error: function(e) {
            var json = JSON.stringify(e, null, 4);
            $("#print_webhook").empty();
            $("#print_webhook").append(document.createTextNode(json));
          }
      });
  });

});
</script>



  <!-- Disqus -->
  
  <div class="post-disqus">
      <section id="disqus_thread"></section>
      <script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//devstrory.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  </div>
  

</div>


    <!-- Documents about icons are here: http://fontawesome.io/icons/ -->
<div class="footer">
  <hr />
  <div class="footer-link">
    
    <a href="https://www.facebook.com/groups/docfriends/"><i class="fa fa-facebook" aria-hidden="true"></i></a>
    
	
	
    <a href="https://www.youtube.com/user/Docairs"><i class="fa fa-youtube" aria-hidden="true"></i></a>
    
	
	

    

    
    <a href="https://github.com/Docfriends"><i class="fa fa-github" aria-hidden="true"></i></a>
    
	
	
	
	

    
	
	
	
	
	
	
	
	

    

    

    
    <a href="mailto:apps@docfriends.com"><i class="fa fa-envelope" aria-hidden="true"></i></a>
    

  </div>
  © 2018 Docfriends. All rights reserved.
</div>

  </div>
</body>
</html>
